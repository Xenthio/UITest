--- /home/runner/sbox-public/engine/Sandbox.Engine/Systems/UI/Panel/Panel.Property.cs	2026-01-01 07:45:59.604934669 +0000
+++ ./src/Sandbox.UI/Panel/Panel.Property.cs	2026-01-01 07:45:47.902924524 +0000
@@ -1,168 +1,130 @@
-ï»¿using System.Reflection;
-
 namespace Sandbox.UI;
 
+/// <summary>
+/// Panel partial class: Property setting methods
+/// Based on s&box's Panel.Property.cs
+/// </summary>
 public partial class Panel
 {
-	/// <summary>
-	/// True when a bind has changed and OnParametersSet call is pending a call
-	/// </summary>
-
-	bool templateBindsChanged = true;
-	Task parametersSetTask;
-
-	internal void ParametersChanged( bool immediately )
-	{
-		templateBindsChanged = true;
-
-		// task is still running
-		if ( parametersSetTask != null && !parametersSetTask.IsCompleted )
-			return;
-
-		if ( immediately )
-		{
-			templateBindsChanged = false;
-
-			parametersSetTask = OnParametersSetInternalAsync();
-		}
-	}
-
-	internal async Task OnParametersSetInternalAsync()
-	{
-		try
-		{
-			await OnParametersSetAsync();
-		}
-		catch ( TaskCanceledException )
-		{
-			return;
-		}
-		catch ( System.Exception e )
-		{
-			Log.Warning( e, $"Exception in OnParametersSetAsync: {e.Message}" );
-		}
-
-		if ( !IsValid )
-			return;
-
-		try
-		{
-			OnParametersSet();
-		}
-		catch ( System.Exception e )
-		{
-			Log.Warning( e, $"Exception in OnParametersSet: {e.Message}" );
-		}
-
-		StateHasChanged();
-	}
-
-	/// <summary>
-	/// Same as <see cref="SetProperty"/>, but first tries to set the property on the panel object, then process any special properties such as <c>class</c>.
-	/// </summary>
-	/// <inheritdoc cref="SetProperty"/>
-	public virtual void SetPropertyObject( string name, object value )
-	{
-		var prop = GetType().GetProperty( name, BindingFlags.IgnoreCase | BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance | BindingFlags.FlattenHierarchy );
-
-		if ( prop != null && prop.PropertyType.IsAssignableFrom( value?.GetType() ) )
-		{
-			prop.SetValue( this, value );
-			return;
-		}
-
-		SetProperty( name, Convert.ToString( value ) );
-	}
-
-	string previousPropertyClass;
-
-	/// <summary>
-	/// Set a property on the panel, such as special properties (<c>class</c>, <c>id</c>, <c>style</c> and <c>value</c>, etc.) and properties of the panel's C# class.
-	/// </summary>
-	/// <param name="name">name of the property to modify.</param>
-	/// <param name="value">Value to assign to the property.</param>
-	public virtual void SetProperty( string name, string value )
-	{
-		if ( name == "id" )
-		{
-			Id = value;
-			return;
-		}
-
-		if ( name == "value" )
-		{
-			StringValue = value;
-			return;
-		}
-
-		if ( name == "class" )
-		{
-			if ( !string.IsNullOrEmpty( previousPropertyClass ) )
-			{
-				RemoveClass( previousPropertyClass );
-			}
-
-			previousPropertyClass = value;
-			AddClass( value );
-			return;
-		}
-
-		if ( name == "style" )
-		{
-			Style.Set( value );
-			return;
-		}
-
-		SetAttribute( name, value );
-
-		Game.TypeLibrary.SetProperty( this, name, value );
-	}
-
-	Dictionary<string, string> Attributes;
-
-	/// <summary>
-	/// Used in templates, gets an attribute that was set in the template.
-	/// </summary>
-	public void SetAttribute( string k, string v )
-	{
-		Attributes ??= new();
-		Attributes[k] = v;
-	}
-
-	/// <summary>
-	/// Used in templates, try to get the attribute that was set in creation.
-	/// </summary>
-	public string GetAttribute( string k, string defaultIfNotFound = default )
-	{
-		if ( Attributes == null ) return defaultIfNotFound;
-
-		if ( Attributes.TryGetValue( k, out var v ) )
-			return v;
-
-		return defaultIfNotFound;
-	}
-
-	/// <summary>
-	/// Called after all templated panel binds have been set.
-	/// </summary>
-	protected virtual void OnParametersSet()
-	{
-		//Log.Info( $"{this} - OnParametersSet" );
-	}
-
-	/// <summary>
-	/// Called after all templated panel binds have been set.
-	/// </summary>
-	protected virtual Task OnParametersSetAsync()
-	{
-		return Task.CompletedTask;
-	}
-
-	/// <summary>
-	/// Called by the templating system when an element has content between its tags.
-	/// </summary>
-	public virtual void SetContent( string value )
-	{
+    private string? _previousPropertyClass;
+    private Dictionary<string, string>? _attributes;
 
-	}
+    /// <summary>
+    /// String value for the panel. Can be used to store simple string data.
+    /// </summary>
+    public string? StringValue { get; set; }
+
+    /// <summary>
+    /// Set a property on the panel, such as special properties (class, id, style and value, etc.)
+    /// and properties of the panel's C# class.
+    /// </summary>
+    /// <param name="name">Name of the property to modify.</param>
+    /// <param name="value">Value to assign to the property.</param>
+    public virtual void SetProperty(string name, string value)
+    {
+        if (name == "id")
+        {
+            Id = value;
+            return;
+        }
+
+        if (name == "value")
+        {
+            StringValue = value;
+            return;
+        }
+
+        if (name == "class")
+        {
+            if (!string.IsNullOrEmpty(_previousPropertyClass))
+            {
+                RemoveClass(_previousPropertyClass);
+            }
+
+            _previousPropertyClass = value;
+            AddClass(value);
+            return;
+        }
+
+        if (name == "style")
+        {
+            Style.Set(value);
+            return;
+        }
+
+        // Store as attribute for derived classes to access
+        SetAttribute(name, value);
+    }
+
+    /// <summary>
+    /// Set an attribute on the panel. Used for custom HTML-like attributes.
+    /// </summary>
+    /// <param name="name">Attribute name</param>
+    /// <param name="value">Attribute value</param>
+    public void SetAttribute(string name, string value)
+    {
+        _attributes ??= new Dictionary<string, string>();
+        _attributes[name.ToLower()] = value;
+    }
+
+    /// <summary>
+    /// Get an attribute value from the panel.
+    /// </summary>
+    /// <param name="name">Attribute name</param>
+    /// <returns>Attribute value, or null if not found</returns>
+    public string? GetAttribute(string name)
+    {
+        if (_attributes == null) return null;
+        _attributes.TryGetValue(name.ToLower(), out var value);
+        return value;
+    }
+
+    /// <summary>
+    /// Get an attribute value from the panel with a default fallback.
+    /// </summary>
+    /// <param name="name">Attribute name</param>
+    /// <param name="defaultValue">Default value if attribute not found</param>
+    /// <returns>Attribute value, or defaultValue if not found</returns>
+    public string? GetAttribute(string name, string? defaultValue)
+    {
+        return GetAttribute(name) ?? defaultValue;
+    }
+
+    /// <summary>
+    /// Check if the panel has an attribute.
+    /// </summary>
+    /// <param name="name">Attribute name</param>
+    /// <returns>True if the attribute exists</returns>
+    public bool HasAttribute(string name)
+    {
+        return _attributes?.ContainsKey(name.ToLower()) ?? false;
+    }
+
+    /// <summary>
+    /// Remove an attribute from the panel.
+    /// </summary>
+    /// <param name="name">Attribute name</param>
+    public void RemoveAttribute(string name)
+    {
+        _attributes?.Remove(name.ToLower());
+    }
+
+    /// <summary>
+    /// Set the content of the panel. For Label, this sets the text.
+    /// For other panels, this can be used to set inner content.
+    /// </summary>
+    /// <param name="value">The content value</param>
+    public virtual void SetContent(string? value)
+    {
+        // Base implementation does nothing - derived classes override this
+    }
+
+    /// <summary>
+    /// Called when parameters are set on the panel (e.g., from Razor).
+    /// Override this to handle parameter updates.
+    /// </summary>
+    protected virtual void OnParametersSet()
+    {
+        // Base implementation does nothing
+    }
 }
